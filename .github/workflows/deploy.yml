name: Deploy to Raspberry Pi

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to Raspberry Pi
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.SSH_PORT }}
          script: |
            cd ~/YOUR-REPO
            
            # Pull latest code
            git pull origin main
            
            # Export secrets as environment variables
            export EXTERNAL_DRIVE_PATH="${{ secrets.EXTERNAL_DRIVE_PATH }}"
            export DOMAIN_NAME="${{ secrets.DOMAIN_NAME }}"
            export SSL_EMAIL="${{ secrets.SSL_EMAIL }}"
            export GOOGLE_CLIENT_ID="${{ secrets.GOOGLE_CLIENT_ID }}"
            export JWT_SECRET_KEY="${{ secrets.JWT_SECRET_KEY }}"
            export JWT_ALGORITHM="${{ secrets.JWT_ALGORITHM }}"
            export ACCESS_TOKEN_EXPIRE_MINUTES="${{ secrets.ACCESS_TOKEN_EXPIRE_MINUTES }}"
            export ALLOWED_EMAILS="${{ secrets.ALLOWED_EMAILS }}"
            export FIRST_USER_EMAIL="${{ secrets.FIRST_USER_EMAIL }}"
            export FIRST_USER_NAME="${{ secrets.FIRST_USER_NAME }}"
            
            # Run production setup script
            ./scripts/setup-production.sh
            
            echo "âœ… Deployment completed at $(date)"